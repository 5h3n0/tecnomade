<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de CEP</title>
</head>
<body>

<!-- Campo de entrada para o CEP -->
<label for="cep">CEP:</label>
<input type="text" id="cep" oninput="mascaraCEP(this)" maxlength="10">
<button onclick="pesquisacep(document.getElementById('cep').value)">Consultar</button>

<!-- Campos para exibir os dados do CEP -->
<label for="rua">Rua:</label>
<input type="text" id="rua" readonly>

<label for="bairro">Bairro:</label>
<input type="text" id="bairro" readonly>

<label for="cidade">Cidade:</label>
<input type="text" id="cidade" readonly>

<label for="uf">UF:</label>
<input type="text" id="uf" readonly>

<script>
function limpa_formulário_cep() {
    // Limpa valores do formulário de cep.
    document.getElementById('rua').value = ("");
    document.getElementById('bairro').value = ("");
    document.getElementById('cidade').value = ("");
    document.getElementById('uf').value = ("");
}

function meu_callback(conteudo) {
    if (!("erro" in conteudo)) {
        // Atualiza os campos com os valores.
        document.getElementById('rua').value = conteudo.logradouro || "";
        document.getElementById('bairro').value = conteudo.bairro || "";
        document.getElementById('cidade').value = conteudo.localidade || "";

        // Adiciona um hífen antes dos últimos três dígitos no campo CEP
        formatarCEP(conteudo.cep);

        // Atualiza o campo UF com a formatação desejada
        document.getElementById('uf').value = formatarUF(conteudo.uf);

    } else {
        // CEP não Encontrado.
        limpa_formulário_cep();
        alert("CEP não encontrado.");
    }
}

function pesquisacep(valor) {
    // Nova variável "cep" somente com dígitos.
    var cep = valor.replace(/\D/g, '');

    // Verifica se campo cep possui valor informado.
    if (cep != "") {
        // Expressão regular para validar o CEP.
        var validacep = /^[0-9]{8}$/;

        // Valida o formato do CEP.
        if (validacep.test(cep)) {
            // Preenche os campos com "..." enquanto consulta webservice.
            document.getElementById('rua').value = "Buscando...";
            document.getElementById('bairro').value = "Buscando...";
            document.getElementById('cidade').value = "Buscando...";
            document.getElementById('uf').value = "Buscando...";

            // Cria um elemento javascript.
            var script = document.createElement('script');

            // Sincroniza com o callback.
            script.src = 'https://viacep.com.br/ws/' + cep + '/json/?callback=meu_callback';

            // Insere script no documento e carrega o conteúdo.
            document.body.appendChild(script);

        } else {
            // CEP é inválido.
            limpa_formulário_cep();
            alert("Formato de CEP inválido.");
        }
    } else {
        // CEP sem valor, limpa formulário.
        limpa_formulário_cep();
    }
}

// Função para adicionar hífen antes dos últimos três dígitos no campo CEP
function formatarCEP(cep) {
    if (cep.length === 8) {
        var cepFormatado = cep.replace(/(\d{5})(\d{3})/, '$1-$2');
        document.getElementById('cep').value = cepFormatado;
    }
}

// Função para adicionar hífen antes dos últimos três dígitos no campo UF
function formatarUF(uf) {
    if (uf.length === 2) {
        return uf.substring(0, 2) + '-';
    }
    return uf;
}

// Máscara para o CEP
function mascaraCEP(input) {
    var valor = input.value.replace(/\D/g, '');

    if (valor.length > 5) {
        input.value = valor.replace(/^(\d{5})(\d{3})/, '$1-$2');
    }
}
</script>

</body>
</html>
